name: 04 - Terraform Destroy

on:
  workflow_dispatch:
    inputs:
      confirm_destroy:
        description: 'Type "destroy" to confirm deletion of all resources'
        required: true
        type: string
      
      delete_s3_bucket:
        description: 'Also delete S3 bucket'
        required: false
        type: boolean
        default: false
      
      force_manual_cleanup:
        description: 'Force manual AWS cleanup if Terraform fails'
        required: false
        type: boolean
        default: false

env:
  TF_VERSION: '1.6.0'
  AWS_REGION: 'us-east-1'

jobs:
  terraform-destroy:
    name: Destroy AWS Infrastructure
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
      id-token: write
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: âš ï¸ Validate Destroy Confirmation
        run: |
          if [ "${{ github.event.inputs.confirm_destroy }}" != "destroy" ]; then
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo "âŒ ERROR: Destroy confirmation failed!"
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo ""
            echo "You must type 'destroy' exactly to confirm."
            echo "Current input: '${{ github.event.inputs.confirm_destroy }}'"
            echo ""
            echo "This is a safety measure to prevent accidental deletion."
            echo ""
            exit 1
          fi
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Destroy confirmed"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ” Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-session-token: ${{ secrets.AWS_SESSION_TOKEN }}
          aws-region: ${{ env.AWS_REGION }}
      
      - name: ğŸ§ª Test AWS Connection
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ§ª Testing AWS Connection..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          aws sts get-caller-identity
          echo "âœ… AWS connection successful!"
      
      - name: ğŸ”§ Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
          terraform_wrapper: false
      
      - name: âš™ï¸ Terraform Init
        working-directory: terraform-k8s-infrastructure
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âš™ï¸ Initializing Terraform..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          terraform init
          echo "âœ… Init completed!"
      
      - name: ğŸ” Check State File
        id: check_state
        working-directory: terraform-k8s-infrastructure
        continue-on-error: true
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” Checking Terraform State..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          # Try to pull state from S3 backend
          terraform state pull > /tmp/current_state.json 2>&1 || true
          
          if [ -s /tmp/current_state.json ] && grep -q "resources" /tmp/current_state.json; then
            echo "âœ… State file found in S3 backend!"
            RESOURCE_COUNT=$(terraform state list 2>/dev/null | wc -l)
            echo "state_exists=true" >> $GITHUB_OUTPUT
            echo "resource_count=$RESOURCE_COUNT" >> $GITHUB_OUTPUT
            echo ""
            echo "ğŸ“Š Resources in state: $RESOURCE_COUNT"
            echo ""
            echo "Resources to destroy:"
            terraform state list || true
          else
            echo "âš ï¸ No state file found!"
            echo "state_exists=false" >> $GITHUB_OUTPUT
            echo ""
            echo "This could mean:"
            echo "1. Infrastructure was already destroyed"
            echo "2. Terraform was never applied"
            echo "3. S3 backend is not configured correctly"
          fi
      
      - name: ğŸ“‹ Show Current Resources in AWS
        continue-on-error: true
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“‹ Checking AWS Resources..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          echo ""
          echo "ğŸ–¥ï¸ EC2 Instances:"
          aws ec2 describe-instances \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
                      "Name=instance-state-name,Values=running,stopped,pending" \
            --query 'Reservations[].Instances[].{ID:InstanceId,Name:Tags[?Key==`Name`]|[0].Value,State:State.Name,IP:PrivateIpAddress}' \
            --output table || echo "No instances found"
          
          echo ""
          echo "ğŸŒ VPCs:"
          aws ec2 describe-vpcs \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'Vpcs[].{ID:VpcId,CIDR:CidrBlock,Name:Tags[?Key==`Name`]|[0].Value}' \
            --output table || echo "No VPCs found"
          
          echo ""
          echo "âš–ï¸ Load Balancers:"
          aws elbv2 describe-load-balancers \
            --query 'LoadBalancers[?contains(LoadBalancerName, `k8s`)].{Name:LoadBalancerName,DNS:DNSName,State:State.Code}' \
            --output table || echo "No load balancers found"
          
          echo ""
          echo "ğŸ”‘ Key Pairs:"
          aws ec2 describe-key-pairs \
            --filters "Name=key-name,Values=petclinic-test-key" \
            --query 'KeyPairs[].{Name:KeyName,ID:KeyPairId}' \
            --output table || echo "No key pairs found"
      
      - name: ğŸ—‘ï¸ Terraform Destroy
        if: steps.check_state.outputs.state_exists == 'true'
        working-directory: terraform-k8s-infrastructure
        continue-on-error: true
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ—‘ï¸ Starting Terraform Destroy..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“Š Resources to destroy: ${{ steps.check_state.outputs.resource_count }}"
          echo ""
          
          # Try destroy with retries
          MAX_RETRIES=3
          RETRY_COUNT=0
          SUCCESS=false
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            echo "Attempt $((RETRY_COUNT + 1)) of $MAX_RETRIES..."
            echo ""
            
            if terraform destroy -auto-approve -input=false; then
              echo ""
              echo "âœ… Terraform Destroy successful!"
              SUCCESS=true
              break
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
                echo ""
                echo "âš ï¸ Destroy failed, waiting 30 seconds before retry..."
                sleep 30
              fi
            fi
          done
          
          if [ "$SUCCESS" = false ]; then
            echo ""
            echo "âŒ Terraform Destroy failed after $MAX_RETRIES attempts"
            echo "Will try manual cleanup next..."
          fi
      
      - name: ğŸ—‘ï¸ Manual AWS Cleanup
        if: |
          (steps.check_state.outputs.state_exists == 'false' && github.event.inputs.force_manual_cleanup == 'true') ||
          (failure() && github.event.inputs.force_manual_cleanup == 'true')
        continue-on-error: true
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ—‘ï¸ Manual AWS Resource Cleanup..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âš ï¸ Terraform state not available or destroy failed"
          echo "Attempting manual cleanup of tagged resources..."
          echo ""
          
          # Function to wait for resource deletion
          wait_for_deletion() {
            local check_command="$1"
            local resource_name="$2"
            local max_wait=60
            local waited=0
            
            echo "Waiting for $resource_name deletion..."
            while [ $waited -lt $max_wait ]; do
              if ! eval "$check_command" &>/dev/null; then
                echo "âœ… $resource_name deleted"
                return 0
              fi
              sleep 5
              waited=$((waited + 5))
            done
            echo "âš ï¸ Timeout waiting for $resource_name deletion"
            return 1
          }
          
          # 1. Terminate EC2 Instances
          echo "1ï¸âƒ£ Terminating EC2 Instances..."
          INSTANCE_IDS=$(aws ec2 describe-instances \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
                      "Name=instance-state-name,Values=running,stopped,pending" \
            --query 'Reservations[].Instances[].InstanceId' \
            --output text)
          
          if [ -n "$INSTANCE_IDS" ]; then
            # Disable termination protection first
            for INSTANCE_ID in $INSTANCE_IDS; do
              echo "  Disabling protection: $INSTANCE_ID"
              aws ec2 modify-instance-attribute \
                --instance-id $INSTANCE_ID \
                --no-disable-api-termination 2>/dev/null || true
            done
            
            # Terminate instances
            echo "  Terminating: $INSTANCE_IDS"
            aws ec2 terminate-instances --instance-ids $INSTANCE_IDS || true
            
            # Wait for termination
            echo "  Waiting for instances to terminate..."
            aws ec2 wait instance-terminated --instance-ids $INSTANCE_IDS 2>/dev/null || sleep 30
            echo "  âœ… Instances terminated"
          else
            echo "  â„¹ï¸ No instances found"
          fi
          
          echo ""
          
          # 2. Delete Load Balancers
          echo "2ï¸âƒ£ Deleting Load Balancers..."
          LB_ARNS=$(aws elbv2 describe-load-balancers \
            --query 'LoadBalancers[?contains(LoadBalancerName, `k8s`)].LoadBalancerArn' \
            --output text)
          
          if [ -n "$LB_ARNS" ]; then
            for LB_ARN in $LB_ARNS; do
              echo "  Deleting: $LB_ARN"
              aws elbv2 delete-load-balancer --load-balancer-arn "$LB_ARN" || true
            done
            sleep 10
            echo "  âœ… Load balancers deleted"
          else
            echo "  â„¹ï¸ No load balancers found"
          fi
          
          echo ""
          
          # 3. Delete Target Groups
          echo "3ï¸âƒ£ Deleting Target Groups..."
          TG_ARNS=$(aws elbv2 describe-target-groups \
            --query 'TargetGroups[?contains(TargetGroupName, `k8s`)].TargetGroupArn' \
            --output text)
          
          if [ -n "$TG_ARNS" ]; then
            for TG_ARN in $TG_ARNS; do
              echo "  Deleting: $TG_ARN"
              aws elbv2 delete-target-group --target-group-arn "$TG_ARN" 2>/dev/null || true
            done
            echo "  âœ… Target groups deleted"
          else
            echo "  â„¹ï¸ No target groups found"
          fi
          
          echo ""
          
          # 4. Delete NAT Gateways
          echo "4ï¸âƒ£ Deleting NAT Gateways..."
          NAT_IDS=$(aws ec2 describe-nat-gateways \
            --filter "Name=tag:Project,Values=petclinic-k8s" \
                     "Name=state,Values=available,pending" \
            --query 'NatGateways[].NatGatewayId' \
            --output text)
          
          if [ -n "$NAT_IDS" ]; then
            for NAT_ID in $NAT_IDS; do
              echo "  Deleting: $NAT_ID"
              aws ec2 delete-nat-gateway --nat-gateway-id "$NAT_ID" || true
            done
            echo "  Waiting for NAT gateways to delete (60s)..."
            sleep 60
            echo "  âœ… NAT gateways deleted"
          else
            echo "  â„¹ï¸ No NAT gateways found"
          fi
          
          echo ""
          
          # 5. Release Elastic IPs
          echo "5ï¸âƒ£ Releasing Elastic IPs..."
          EIP_ALLOC_IDS=$(aws ec2 describe-addresses \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'Addresses[].AllocationId' \
            --output text)
          
          if [ -n "$EIP_ALLOC_IDS" ]; then
            for ALLOC_ID in $EIP_ALLOC_IDS; do
              echo "  Releasing: $ALLOC_ID"
              aws ec2 release-address --allocation-id "$ALLOC_ID" 2>/dev/null || true
            done
            echo "  âœ… Elastic IPs released"
          else
            echo "  â„¹ï¸ No Elastic IPs found"
          fi
          
          echo ""
          
          # 6. Delete Network Interfaces
          echo "6ï¸âƒ£ Deleting Network Interfaces..."
          sleep 10  # Wait for resources to detach
          ENI_IDS=$(aws ec2 describe-network-interfaces \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'NetworkInterfaces[?Status==`available`].NetworkInterfaceId' \
            --output text)
          
          if [ -n "$ENI_IDS" ]; then
            for ENI_ID in $ENI_IDS; do
              echo "  Deleting: $ENI_ID"
              aws ec2 delete-network-interface --network-interface-id "$ENI_ID" 2>/dev/null || true
            done
            echo "  âœ… Network interfaces deleted"
          else
            echo "  â„¹ï¸ No available network interfaces found"
          fi
          
          echo ""
          
          # 7. Delete Security Groups (except default)
          echo "7ï¸âƒ£ Deleting Security Groups..."
          sleep 5
          SG_IDS=$(aws ec2 describe-security-groups \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'SecurityGroups[?GroupName!=`default`].GroupId' \
            --output text)
          
          if [ -n "$SG_IDS" ]; then
            # Try multiple times as there might be dependencies
            for i in {1..3}; do
              echo "  Deletion attempt $i..."
              for SG_ID in $SG_IDS; do
                aws ec2 delete-security-group --group-id "$SG_ID" 2>/dev/null && \
                  echo "    âœ… Deleted: $SG_ID" || \
                  echo "    â³ Waiting: $SG_ID"
              done
              [ $i -lt 3 ] && sleep 10
            done
          else
            echo "  â„¹ï¸ No security groups found"
          fi
          
          echo ""
          
          # 8. Delete Subnets
          echo "8ï¸âƒ£ Deleting Subnets..."
          SUBNET_IDS=$(aws ec2 describe-subnets \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'Subnets[].SubnetId' \
            --output text)
          
          if [ -n "$SUBNET_IDS" ]; then
            for SUBNET_ID in $SUBNET_IDS; do
              echo "  Deleting: $SUBNET_ID"
              aws ec2 delete-subnet --subnet-id "$SUBNET_ID" 2>/dev/null || true
            done
            echo "  âœ… Subnets deleted"
          else
            echo "  â„¹ï¸ No subnets found"
          fi
          
          echo ""
          
          # 9. Detach and Delete Internet Gateways
          echo "9ï¸âƒ£ Deleting Internet Gateways..."
          VPC_IDS=$(aws ec2 describe-vpcs \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'Vpcs[].VpcId' \
            --output text)
          
          for VPC_ID in $VPC_IDS; do
            IGW_IDS=$(aws ec2 describe-internet-gateways \
              --filters "Name=attachment.vpc-id,Values=$VPC_ID" \
              --query 'InternetGateways[].InternetGatewayId' \
              --output text)
            
            for IGW_ID in $IGW_IDS; do
              echo "  Detaching IGW: $IGW_ID from VPC: $VPC_ID"
              aws ec2 detach-internet-gateway \
                --internet-gateway-id "$IGW_ID" \
                --vpc-id "$VPC_ID" 2>/dev/null || true
              
              echo "  Deleting IGW: $IGW_ID"
              aws ec2 delete-internet-gateway \
                --internet-gateway-id "$IGW_ID" 2>/dev/null || true
            done
          done
          
          echo ""
          
          # 10. Delete Route Tables (except main)
          echo "ğŸ”Ÿ Deleting Route Tables..."
          for VPC_ID in $VPC_IDS; do
            RT_IDS=$(aws ec2 describe-route-tables \
              --filters "Name=vpc-id,Values=$VPC_ID" \
                        "Name=tag:Project,Values=petclinic-k8s" \
              --query 'RouteTables[?Associations[0].Main!=`true`].RouteTableId' \
              --output text)
            
            for RT_ID in $RT_IDS; do
              echo "  Deleting: $RT_ID"
              aws ec2 delete-route-table --route-table-id "$RT_ID" 2>/dev/null || true
            done
          done
          
          echo ""
          
          # 11. Delete VPCs
          echo "1ï¸âƒ£1ï¸âƒ£ Deleting VPCs..."
          if [ -n "$VPC_IDS" ]; then
            for VPC_ID in $VPC_IDS; do
              echo "  Deleting VPC: $VPC_ID"
              aws ec2 delete-vpc --vpc-id "$VPC_ID" 2>/dev/null || true
            done
            echo "  âœ… VPCs deleted"
          else
            echo "  â„¹ï¸ No VPCs found"
          fi
          
          echo ""
          
          # 12. Delete Key Pair
          echo "1ï¸âƒ£2ï¸âƒ£ Deleting Key Pair..."
          aws ec2 delete-key-pair --key-name petclinic-test-key 2>/dev/null && \
            echo "  âœ… Key pair deleted" || \
            echo "  â„¹ï¸ Key pair not found"
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Manual cleanup completed!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ—‘ï¸ Delete S3 Bucket
        if: github.event.inputs.delete_s3_bucket == 'true'
        continue-on-error: true
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ—‘ï¸ Deleting S3 Bucket..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          BUCKET_NAME="petclinic-atos"
          
          # Check if bucket exists
          if aws s3api head-bucket --bucket "$BUCKET_NAME" 2>/dev/null; then
            echo "Emptying bucket..."
            aws s3 rm "s3://${BUCKET_NAME}" --recursive || true
            
            echo "Deleting bucket..."
            aws s3api delete-bucket --bucket "$BUCKET_NAME" --region ${{ env.AWS_REGION }} || true
            
            echo "âœ… S3 Bucket deleted!"
          else
            echo "â„¹ï¸ S3 Bucket not found or already deleted"
          fi
      
      - name: ğŸ§¹ Clean Local State
        if: always()
        working-directory: terraform-k8s-infrastructure
        continue-on-error: true
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ§¹ Cleaning local state files..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          rm -f terraform.tfstate
          rm -f terraform.tfstate.backup
          rm -f .terraform.lock.hcl
          rm -rf .terraform/
          
          echo "âœ… Local state cleaned!"
      
      - name: ğŸ” Verify Cleanup
        if: always()
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” Verifying Resource Cleanup..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          echo ""
          echo "Remaining EC2 Instances:"
          REMAINING_INSTANCES=$(aws ec2 describe-instances \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
                      "Name=instance-state-name,Values=running,stopped,pending" \
            --query 'Reservations[].Instances[].InstanceId' \
            --output text | wc -w)
          echo "  Count: $REMAINING_INSTANCES"
          
          echo ""
          echo "Remaining VPCs:"
          REMAINING_VPCS=$(aws ec2 describe-vpcs \
            --filters "Name=tag:Project,Values=petclinic-k8s" \
            --query 'Vpcs[].VpcId' \
            --output text | wc -w)
          echo "  Count: $REMAINING_VPCS"
          
          echo ""
          echo "Remaining Load Balancers:"
          REMAINING_LBS=$(aws elbv2 describe-load-balancers \
            --query 'LoadBalancers[?contains(LoadBalancerName, `k8s`)].LoadBalancerName' \
            --output text | wc -w)
          echo "  Count: $REMAINING_LBS"
          
          echo ""
          if [ "$REMAINING_INSTANCES" -eq 0 ] && [ "$REMAINING_VPCS" -eq 0 ] && [ "$REMAINING_LBS" -eq 0 ]; then
            echo "âœ… All resources cleaned up successfully!"
          else
            echo "âš ï¸ Some resources may still remain"
            echo "Check AWS Console for any remaining resources"
          fi
      
      - name: âœ… Destroy Complete
        if: success()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  âœ… Destroy Completed Successfully!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“Š All infrastructure has been destroyed"
          echo ""
          echo "ğŸ’° Cost Impact:"
          echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
          echo "  â€¢ AWS charges will stop immediately"
          echo "  â€¢ No more EC2 hourly charges"
          echo "  â€¢ No more NAT Gateway charges (~$0.045/hr)"
          echo "  â€¢ No more EBS storage charges"
          echo ""
          echo "ğŸ”„ To redeploy:"
          echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
          echo "  1. Run '02 - Terraform Apply' workflow"
          echo "  2. Wait ~10 minutes"
          echo "  3. Run '03 - Ansible Provision' workflow"
          echo "  4. Cluster will be fully recreated"
          echo ""
